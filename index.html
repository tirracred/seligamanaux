<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeligaManaux - Notícias de Manaus</title>

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <!-- Google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4935884639623224" crossorigin="anonymous"></script>
</head>
<body>
<!-- SEU HEADER ATUALIZADO (com 24H e WhatsApp) -->
<header class="site-header">
    <div class="header-container">
        <div class="logo"><a href="/"><h1>SELIGAMANAUX24H</h1></a></div>
        
        <!-- LINK DISCRETO DO WHATSAPP -->
        <a href="https://wa.me/+5592SEUNUMERO" target="_blank" class="whatsapp-denuncia" title="Fazer denúncia via WhatsApp">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle;">
                <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.0-6.556 5.333-11.891 11.893-11.891 3.181.0 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.0 6.557-5.335 11.893-11.893 11.893-1.99-.0-3.903-.52-5.607-1.474l-6.17 1.688a.75.75 0 0 1-.947-.947zM6.505 4.615a.9.9 0 0 0-.663-.306c-.151.0-.301.03-.448.09-.147.06-.29.14-.418.23-.129.09-.243.2-.34.31-.1.11-.18.22-.24.34-.06.11-.1.23-.13.34-.03.12-.04.24-.04.36s.01.24.04.36c.03.12.08.23.13.34.06.11.14.22.24.34.1.11.21.21.34.31.13.1.27.17.42.23.15.06.3.09.45.09.16.0.32-.03.47-.09.15-.06.29-.14.41-.23.12-.09.23-.2.33-.31.1-.11.18-.22.24.34.06-.11.1-.23.13.34.03-.12.04-.24.04-.36s-.01-.24-.04-.36c-.03-.12-.08-.23-.13-.34-.06-.11-.14-.22-.24-.34-.1-.11-.21-.21-.33-.31-.12-.1-.26-.17-.41-.23-.15-.06-.3-.09-.47-.09zm5.02 11.41c-.13.34-.5.62-.96.62-.3 0-.58-.07-.84-.21-.26-.14-.5-.33-.71-.56-.21-.23-.4-.49-.56-.78-.16-.29-.24-.61-.24-.95 0-.34.08-.65.24-.92.16-.27.35-.5.56-.71.21-.2.45-.37.71-.5.26-.13.54-.2.84-.2s.58.07.84.2c.26.13.5.3.71.5.21.2.39.43.56.71.16.27.24.58.24.92 0 .34-.08.66-.24.95-.16.29-.35.55-.56.78-.21.23-.44.42-.71.56-.26.14-.54.21-.84.21-.46 0-.83-.28-.96-.62h-1.02c.16.59.48 1.07.92 1.41.44.34.96.52 1.54.52s1.1-.18 1.54-.52c.44-.34.76-.82.92-1.41h-1.02z"/>
            </svg>
        </a>
        <!-- FIM DO LINK DO WHATSAPP -->

        <button class="nav-toggle" aria-label="Abrir menu"><span class="hamburger"></span></button>
        <nav class="nav-principal">
            <ul>
                <li><a href="/" class="ativo">Início</a></li>
                <li><a href="ultimas-noticias.html">Últimas Notícias</a></li>
                <li><a href="manaus-e-regiao.html">Manaus e Região</a></li>
            </ul>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-toggle">
                    <input type="checkbox" id="theme-toggle" />
                    <span class="slider"></span>
                </label>
            </div>
        </nav>
    </div>
</header>

<!-- Banner Denúncia no WhatsApp (Opcional, se você quiser manter) -->
<!-- <div class="denuncia-banner"> ... </div> -->

<main class="container">
    <!-- Mais Vistos Section -->
    <section class="mais-vistos-section">
        <h2>Mais vistos</h2>
        <div id="mais-vistos-loading" style="text-align:center; padding: 2rem 0;">Carregando notícias...</div>
        <div class="carousel-container" id="mais-vistos-container" style="display:none;">
            <button class="carousel-prev" id="carousel-prev">&#8249;</button>
            <div class="carousel-track" id="mais-vistos-track"></div>
            <button class="carousel-next" id="carousel-next">&#8250;</button>
        </div>
    </section>

    <!-- Categories Section -->
    <div id="categories-loading" style="text-align:center; padding: 2rem 0;">Carregando notícias...</div>
    <div id="categories-sections" style="display:none;">
        <!-- Geral -->
        <section class="category-section" id="category-geral">
            <h2>Geral</h2>
            <div class="feed-grid" id="category-geral-container"></div>
        </section>
        <!-- Política -->
        <section class="category-section" id="category-politica">
            <h2>Política</h2>
            <div class="feed-grid" id="category-politica-container"></div>
        </section>
        <!-- Economia -->
        <section class="category-section" id="category-economia">
            <h2>Economia</h2>
            <div class="feed-grid" id="category-economia-container"></div>
        </section>
        <!-- Esportes -->
        <section class="category-section" id="category-esportes">
            <h2>Esportes</h2>
            <div class="feed-grid" id="category-esportes-container"></div>
        </section>
        <!-- Cultura -->
        <section class="category-section" id="category-cultura">
            <h2>Cultura</h2>
            <div class="feed-grid" id="category-cultura-container"></div>
        </section>
        <!-- Amazonas -->
        <section class="category-section" id="category-amazonas">
            <h2>Amazonas</h2>
            <div class="feed-grid" id="category-amazonas-container"></div>
        </section>
    </div>

    <div id="load-more" style="text-align:center; padding: 1rem; display:none; color:#6b7280;">Carregando mais...</div>
</main>

<footer class="site-footer">
    <p style="text-align:center; padding: 1rem 0; color:#6b7280;">&copy; 2025 SeligaManaux. Grupo Tirracred 61.811.560/0001-10 - Todos os direitos reservados.</p>
</footer>

<!-- Supabase JS (Mantido) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- 
  =================================================================
  SCRIPT PRINCIPAL SUBSTITUÍDO (Correção do Scroll Infinito)
  =================================================================
-->
<script>
/* Configuração do Supabase (Mantida) */
const SUPABASE_URL     = 'https://xtnqypmezntjcidglblc.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0bnF5cG1lem50amNpZGdsYmxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5ODEwMDksImV4cCI6MjA3NzU1NzAwOX0.fz__YKaMuEWjoXVansGZnLgUhsdsg7J1tLCriMhV8Ls';
const DB_TABLE         = 'noticias';
let supabase;
try {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
} catch (e) {
    console.error('Erro ao inicializar Supabase:', e);
}

/* Utilitário para criar um card de notícia (Mantido) */
function createNewsCard(post) {
    const article = document.createElement('article');
    article.className = 'card-noticia';
    const imageUrl = post.image_url || 'https://placehold.co/600x400/1f2937/9ca3af?text=SeligaManaux';
    const titleColorClass = post.headline_color === 'red' ? 'titulo-vermelho' : 'titulo-azul';
    article.innerHTML = `
        <a href="artigo.html?id=${post.id}">
            <img src="${imageUrl}" alt="${post.title}">
            <div class="card-conteudo">
                <span class="categoria-tag">${post.category || 'Geral'}</span>
                <h4 class="${titleColorClass}">${post.title}</h4>
                <p>${post.content ? post.content.substring(0, 100) + '...' : ''}</p>
            </div>
        </a>
    `;
    return article;
}


/* =================================
 INÍCIO DO SCRIPT DE CARREGAMENTO
 =================================
*/
document.addEventListener('DOMContentLoaded', async () => {
    // Menu mobile toggle (Mantido)
    const navToggle    = document.querySelector('.nav-toggle');
    const navPrincipal = document.querySelector('.nav-principal');
    if (navToggle && navPrincipal) {
        navToggle.addEventListener('click', () => {
            navPrincipal.classList.toggle('ativo');
            navToggle.querySelector('.hamburger').classList.toggle('ativo');
        });
    }

    // Tema claro/escuro (Mantido)
    const themeToggle = document.getElementById('theme-toggle');
    const body        = document.body;
    function applyTheme(theme) {
        if (theme === 'dark') {
            body.classList.add('dark-mode');
            if (themeToggle) themeToggle.checked = true;
        } else {
            body.classList.remove('dark-mode');
            if (themeToggle) themeToggle.checked = false;
        }
    }
    function saveTheme(theme) { localStorage.setItem('theme', theme); }
    if (themeToggle) {
        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                applyTheme('dark'); saveTheme('dark');
            } else {
                applyTheme('light'); saveTheme('light');
            }
        });
    }
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        applyTheme('light');
    }

    // Carousel controls (Mantido)
    const carouselTrack = document.getElementById('mais-vistos-track');
    const prevBtn       = document.getElementById('carousel-prev');
    const nextBtn       = document.getElementById('carousel-next');
    if (prevBtn && nextBtn && carouselTrack) {
        prevBtn.addEventListener('click', () => {
            carouselTrack.scrollBy({ left: -carouselTrack.clientWidth * 0.8, behavior: 'smooth' });
        });
        nextBtn.addEventListener('click', () => {
            carouselTrack.scrollBy({ left: carouselTrack.clientWidth * 0.8, behavior: 'smooth' });
        });
    }

    // Carrega notícias em destaque (mais recentes) (Mantido)
    let highlightPosts = [];
    try {
        const { data: highlightData, error: highlightError } = await supabase
            .from(DB_TABLE)
            .select('id, title, content, image_url, category, created_at, headline_color')
            .order('created_at', { ascending: false })
            .limit(5);
        if (highlightError) {
            console.error('Erro ao carregar notícias em destaque:', highlightError);
            document.getElementById('mais-vistos-loading').innerText = 'Erro ao carregar notícias.';
        } else if (highlightData && highlightData.length > 0) {
            highlightPosts = highlightData;
        } else {
            document.getElementById('mais-vistos-loading').innerText = 'Nenhuma notícia disponível.';
        }
    } catch (err) {
        console.error('Erro na requisição de destaque:', err);
        document.getElementById('mais-vistos-loading').innerText = 'Erro ao carregar notícias.';
    }

    if (highlightPosts.length > 0) {
        const trackEl = document.getElementById('mais-vistos-track');
        highlightPosts.forEach(post => {
            trackEl.appendChild(createNewsCard(post));
        });
        document.getElementById('mais-vistos-loading').style.display = 'none';
        document.getElementById('mais-vistos-container').style.display = 'block';
    }

    /* =================================
     NOVA LÓGICA DE SCROLL INFINITO
     =================================
    */
    
    // Variáveis de controle de paginação
    let offset     = highlightPosts.length; // Começa a buscar DEPOIS dos posts do carrossel
    const pageSize = 10;
    let reachedEnd = false;
    let isLoading = false; // <-- NOVA VARIÁVEL (Trava)

    const loadMoreIndicator = document.getElementById('load-more');

    // NOVA FUNÇÃO: Verifica se a página já tem scroll
    function checkIfPageIsScrollable() {
        // Espera um instante para o DOM atualizar
        setTimeout(() => {
            if (reachedEnd || isLoading) return;

            const documentHeight = Math.max(
                document.body.scrollHeight, document.documentElement.scrollHeight
            );
            const viewportHeight = document.documentElement.clientHeight;

            // Se o conteúdo for menor que a tela, busca mais
            if (documentHeight <= viewportHeight) {
                console.log("Conteúdo não preencheu a tela, buscando mais...");
                fetchAndDisplayPosts();
            }
        }, 100); // 100ms de espera
    }

    // FUNÇÃO ATUALIZADA: fetchAndDisplayPosts
    async function fetchAndDisplayPosts() {
        // Verifica as travas
        if (reachedEnd || isLoading || !supabase) return;

        isLoading = true; // Ativa a trava
        loadMoreIndicator.style.display = 'block';

        try {
            const { data: posts, error: postsError } = await supabase
                .from(DB_TABLE)
                .select('id, title, content, image_url, category, created_at, headline_color')
                .order('created_at', { ascending: false })
                .range(offset, offset + pageSize - 1);
            
            if (postsError) {
                console.error('Erro ao carregar notícias:', postsError);
                loadMoreIndicator.innerText = 'Erro ao carregar mais notícias.';
                reachedEnd = true;
                return; // Sai da função
            }

            if (posts && posts.length > 0) {
                posts.forEach(post => {
                    // Normaliza o nome da categoria para usar como ID
                    const category = post.category ? 
                        post.category.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9-]+/g, '-') 
                        : 'geral';
                    const container = document.getElementById(`category-${category}-container`);
                    
                    if (container) {
                        container.appendChild(createNewsCard(post));
                    } else {
                        // Se a categoria não existir (ex: "geral"), adiciona em "Geral"
                        document.getElementById('category-geral-container').appendChild(createNewsCard(post));
                    }
                });
                
                document.getElementById('categories-loading').style.display = 'none';
                document.getElementById('categories-sections').style.display = 'block';
                
                offset += posts.length; // Atualiza o offset
                
                if (posts.length < pageSize) {
                    reachedEnd = true;
                    loadMoreIndicator.style.display = 'none';
                }
            } else {
                reachedEnd = true;
                loadMoreIndicator.style.display = 'none';
            }

            
        } catch (err) {
            console.error('Erro na requisição de notícias:', err);
            loadMoreIndicator.style.display = 'none';
            reachedEnd = true;
        } finally {
            isLoading = false; // Libera a trava
            
            // Chama a verificação para ver se precisa carregar mais
            checkIfPageIsScrollable();
        }
    }

    // Carrega posts iniciais (Mantido)
    fetchAndDisplayPosts();

    // LISTENER DE SCROLL ATUALIZADO
    window.addEventListener('scroll', () => {
        if (reachedEnd || isLoading) return; // Usa a nova trava

        // Lógica de scroll mais robusta
        const documentHeight = Math.max(
            document.body.scrollHeight, document.documentElement.scrollHeight,
            document.body.offsetHeight, document.documentElement.offsetHeight,
            document.body.clientHeight, document.documentElement.clientHeight
        );
        const windowBottom = window.innerHeight + window.scrollY;

        // 150px de "folga" para carregar antes de chegar ao fim
        if (windowBottom >= documentHeight - 150) {
            fetchAndDisplayPosts();
        }
    });
});
</script>
</body>

</html>



