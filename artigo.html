<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carregando... - SeligaManaux</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    </head>
<body>

    <header class="site-header">
        <div class="header-container">
            <div class="logo">
                <a href="/"><h1>SELIGAMANAUX</h1></a>
            </div>
            <button class="nav-toggle" aria-label="Abrir menu">
                <span class="hamburger"></span>
            </button>
            <nav class="nav-principal">
                <ul>
                    <li><a href="/">Início</a></li>
                    <li><a href="ultimas-noticias.html">Últimas Notícias</a></li>
                    <li><a href="manaus-e-regiao.html">Manaus e Região</a></li>
                </ul>
                
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="theme-toggle">
                        <input type="checkbox" id="theme-toggle" />
                        <span class="slider"></span>
                    </label>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <article id="article-container">
            
            <div id="loading-message" style="text-align: center; padding: 4rem 0;">
                <p style="font-size: 1.2rem; color: var(--texto-secundario);">Carregando artigo...</p>
            </div>
            </article>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 SeligaManaux. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const articleContainer = document.getElementById('article-container');
            const loadingMessage = document.getElementById('loading-message');

            function formatTimestamp(dateString) {
                const date = new Date(dateString);
                const options = { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit', 
                    minute: '2-digit' 
                };
                return date.toLocaleString('pt-BR', options);
            }

            async function loadArticle() {
                const urlParams = new URLSearchParams(window.location.search);
                const articleId = urlParams.get('id');

                if (!articleId) {
                    loadingMessage.innerHTML = '<h1 class="page-title">Erro</h1><p style="color: var(--texto-secundario);">Nenhum artigo foi especificado.</p>';
                    return;
                }
                
                if (!supabase) {
                    console.error("Supabase client not initialized.");
                    loadingMessage.innerHTML = '<h1 class="page-title">Erro de Conexão</h1>';
                    return;
                }

                try {
                    const { data: post, error } = await supabase
                        .from(DB_TABLE)
                        .select('*, headline_color') // Pega a coluna de cor
                        .eq('id', articleId) 
                        .single();

                    if (error) throw error;

                    if (!post) {
                        loadingMessage.innerHTML = '<h1 class="page-title">Artigo não encontrado</h1><p style="color: var(--texto-secundario);">O link que você seguiu pode estar quebrado ou o artigo foi removido.</p>';
                        return;
                    }

                    renderArticle(post);

                } catch (err) {
                    console.error("Erro ao buscar artigo:", err);
                    loadingMessage.innerHTML = '<h1 class="page-title">Erro ao Carregar</h1><p style="color: var(--texto-secundario);">Não foi possível conectar ao banco de dados para carregar este artigo.</p>';
                }
            }

            function renderArticle(post) {
                document.title = `${post.title} - SeligaManaux`;
                loadingMessage.style.display = 'none';

                // Formata o conteúdo: substitui quebras de linha (\n) por tags <p>
                const formattedContent = post.content
                    .split('\n') 
                    .filter(p => p.trim() !== '') 
                    .map(p => `<p>${p}</p>`) 
                    .join(''); 

                // Define a classe de cor do título
                const titleColorClass = post.headline_color === 'red' ? 'titulo-vermelho' : 'titulo-azul';

                articleContainer.innerHTML = `
                    <span class="categoria-tag">${post.category || 'Geral'}</span>
                    
                    <h1 class="page-title ${titleColorClass}" style="border-bottom: none; margin: 0.5rem 0 0.5rem 0; line-height: 1.2;">
                        ${post.title}
                    </h1>
                    
                    <p class="article-meta">
                        Publicado em ${formatTimestamp(post.created_at)}
                    </p>
                    
                    ${post.image_url ? `<img src="${post.image_url}" alt="${post.title}" class="article-image">` : ''}
                    
                    <div class="article-body">
                        ${formattedContent}
                    </div>
                `;
            }

            loadArticle();
        });
    </script>
</body>

</html>
